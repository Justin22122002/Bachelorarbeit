import time

import pandas as pd

from malwareAnalysis.virustotal.VirusTotalClient import VirusTotalClient


def main() -> None:
    API_KEY = 'API_KEY'
    output_file = 'virustotal_results.csv'

    # Instanz der VirusTotalClient-Klasse erstellen
    vt_client = VirusTotalClient(API_KEY, output_file)

    # Daten laden
    df = pd.read_csv('../../ml/datasets/output_file_Run_1_labeled.csv')
    df['Raw_Type'] = df['Raw_Type'].apply(vt_client.clean_raw_type)

    # Daten iterieren und verarbeiten
    for _, row in df.iterrows():
        vt_client.process_and_save(
            raw_type=row['Raw_Type'],
            label=row['Label'],
            subtype=row['SubType']
        )
        time.sleep(20)

    print(f"Alle Ergebnisse wurden in '{output_file}' gespeichert.")

if __name__ == '__main__':
    main()