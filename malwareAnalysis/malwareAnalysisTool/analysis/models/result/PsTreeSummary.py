from dataclasses import dataclass
from typing_extensions import override

from malwareAnalysis.malwareAnalysisTool.analysis.models.result.Summary import Summary


@dataclass
class PsTreeSummary(Summary):
    """
    A data class to store summarized pstree metrics.

    Attributes:
        nTree (int): Total number of processes in the tree.
        nHandles (int): Total number of unique parent process IDs.
        nPID (int): Average thread count.
        nPPID (int): Average handler count.
        AvgThreads (float): Number of 64-bit processes.
        nWow64 (int): Number of processes with FileOutput enabled.
        AvgChildren (float): Average number of child processes per parent.
    """

    nTree: int
    nHandles: int
    nPID: int
    nPPID: int
    AvgThreads: float
    nWow64: int
    AvgChildren: float

    @override
    def create_csv_summary(self) -> list[int | float]:
        """
        Generate a CSV-compatible summary as a list of values.
        """
        return [
            self.nTree,
            self.nHandles,
            self.nPID,
            self.nPPID,
            self.AvgThreads,
            self.nWow64,
            self.AvgChildren
        ]

    @override
    def create_csv_header(self) -> list[str]:
        """
        Return a CSV-compatible header.
        """
        return [
            "pstree_nTree",
            "pstree_nHandles",
            "pstree_nPID",
            "pstree_nPPID",
            "pstree_AvgThreads",
            "pstree_nWow64",
            "pstree_AvgChildren"
        ]

    def __str__(self) -> str:
        """
        Provide a readable string representation of the summary.
        """
        return (f"PsTree Summary:\n"
                f"  Total Processes in Tree (nTree): {self.nTree}\n"
                f"  Total Handles (nHandles): {self.nHandles}\n"
                f"  Unique Process IDs (nPID): {self.nPID}\n"
                f"  Unique Parent PIDs (nPPID): {self.nPPID}\n"
                f"  Average Threads per Process (AvgThreads): {self.AvgThreads:.9f}\n"
                f"  Total Wow64 Processes (nWow64): {self.nWow64}\n"
                f"  Average Child Processes per Parent (AvgChildren): {self.AvgChildren:.9f}\n")
