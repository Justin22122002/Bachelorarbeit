from dataclasses import dataclass
from typing_extensions import override
from malwareAnalysis.malwareAnalysisTool.analysis.models.result.Summary import Summary


@dataclass
class PsxViewSummary(Summary):
    """
    A data class to store summarized PsxView metrics.

    Attributes:
        psxview_not_in_pslist (int): Total number of processes not found in the pslist.
        psxview_not_in_eprocess_pool (int): Total number of processes not found in the psscan.
        psxview_not_in_ethread_pool (int): Total number of threads not found in the thrdproc.
        psxview_not_in_pspcid_list (int): Total number of processes not found in the pspcid.
        psxview_not_in_csrss_handles (int): Total number of handles not found in csrss.
        psxview_not_in_session (int): Total number of processes not found in the session.
        psxview_not_in_deskthrd (int): Total number of processes not found in the deskthrd.
        psxview_not_in_pslist_false_avg (float): Average false ratio of the process list.
        psxview_not_in_eprocess_pool_false_avg (float): Average false ratio of the process scan.
        psxview_not_in_ethread_pool_false_avg (float): Average false ratio of the third process.
        psxview_not_in_pspcid_list_false_avg (float): Average false ratio of the process id.
        psxview_not_in_csrss_handles_false_avg (float): Average false ratio of csrss.
        psxview_not_in_session_false_avg (float): Average false ratio of the session.
        psxview_not_in_deskthrd_false_avg (float): Average false ratio of the deskthrd.
    """

    psxview_not_in_pslist: int
    psxview_not_in_eprocess_pool: int
    psxview_not_in_ethread_pool: int
    psxview_not_in_pspcid_list: int
    psxview_not_in_csrss_handles: int
    psxview_not_in_session: int
    psxview_not_in_deskthrd: int
    psxview_not_in_pslist_false_avg: float
    psxview_not_in_eprocess_pool_false_avg: float
    psxview_not_in_ethread_pool_false_avg: float
    psxview_not_in_pspcid_list_false_avg: float
    psxview_not_in_csrss_handles_false_avg: float
    psxview_not_in_session_false_avg: float
    psxview_not_in_deskthrd_false_avg: float

    @override
    def create_csv_header(self) -> list[str]:
        """
        Return a CSV-compatible header.
        """
        return [
            "psxview_not_in_pslist", "psxview_not_in_eprocess_pool", "psxview_not_in_ethread_pool",
            "psxview_not_in_pspcid_list", "psxview_not_in_csrss_handles", "psxview_not_in_session",
            "psxview_not_in_deskthrd", "psxview_not_in_pslist_false_avg", "psxview_not_in_eprocess_pool_false_avg",
            "psxview_not_in_ethread_pool_false_avg", "psxview_not_in_pspcid_list_false_avg",
            "psxview_not_in_csrss_handles_false_avg", "psxview_not_in_session_false_avg",
            "psxview_not_in_deskthrd_false_avg"
        ]

    @override
    def create_csv_summary(self) -> list[int | float]:
        """
        Generate a CSV-compatible summary as a list of values.
        """
        return [
            self.psxview_not_in_pslist, self.psxview_not_in_eprocess_pool, self.psxview_not_in_ethread_pool,
            self.psxview_not_in_pspcid_list, self.psxview_not_in_csrss_handles, self.psxview_not_in_session,
            self.psxview_not_in_deskthrd, self.psxview_not_in_pslist_false_avg, self.psxview_not_in_eprocess_pool_false_avg,
            self.psxview_not_in_ethread_pool_false_avg, self.psxview_not_in_pspcid_list_false_avg,
            self.psxview_not_in_csrss_handles_false_avg, self.psxview_not_in_session_false_avg,
            self.psxview_not_in_deskthrd_false_avg
        ]

    def __str__(self) -> str:
        """
        Provide a readable string representation of the summary.
        """
        return (f"PsxView Summary:\n"
                f"  Not in PsList: {self.psxview_not_in_pslist}\n"
                f"  Not in EProcess Pool: {self.psxview_not_in_eprocess_pool}\n"
                f"  Not in EThread Pool: {self.psxview_not_in_ethread_pool}\n"
                f"  Not in PsCid List: {self.psxview_not_in_pspcid_list}\n"
                f"  Not in CSRSS Handles: {self.psxview_not_in_csrss_handles}\n"
                f"  Not in Session: {self.psxview_not_in_session}\n"
                f"  Not in Desktop Thread: {self.psxview_not_in_deskthrd}\n"
                f"  Avg Not in PsList False: {self.psxview_not_in_pslist_false_avg:.9f}\n"
                f"  Avg Not in EProcess Pool False: {self.psxview_not_in_eprocess_pool_false_avg:.9f}\n"
                f"  Avg Not in EThread Pool False: {self.psxview_not_in_ethread_pool_false_avg:.9f}\n"
                f"  Avg Not in PsCid List False: {self.psxview_not_in_pspcid_list_false_avg:.9f}\n"
                f"  Avg Not in CSRSS Handles False: {self.psxview_not_in_csrss_handles_false_avg:.9f}\n"
                f"  Avg Not in Session False: {self.psxview_not_in_session_false_avg:.9f}\n"
                f"  Avg Not in Desktop Thread False: {self.psxview_not_in_deskthrd_false_avg:.9f}\n")